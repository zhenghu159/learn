---
title: "R Notebook"
output: 
  html_notebook: 
    toc: yes
    css: C:/Users/13081/OneDrive - webmail.hzau.edu.cn/Github/learn/R/notebook.css
    number_sections: yes
---

# Installing Monocle 3
## Required software
To install Bioconductor, open R and run:
```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(version = "3.14")
```

Next, install a few Bioconductor dependencies that aren't automatically installed:
```{r}
BiocManager::install(c('BiocGenerics', 'DelayedArray', 'DelayedMatrixStats',
                       'limma', 'lme4', 'S4Vectors', 'SingleCellExperiment',
                       'SummarizedExperiment', 'batchelor', 'Matrix.utils',
                       'HDF5Array', 'terra', 'ggrastr'))
```

Now, install monocle3 through the cole-trapnell-lab GitHub, execute:
```{r}
install.packages("devtools")
devtools::install_github('cole-trapnell-lab/monocle3')
```

## Testing the installation
To ensure that Monocle 3 was installed correctly, start a new R session and run:
```{r}
library(monocle3)
```


# Getting started with Monocle 3
## Load Monocle 3
```{r}
library(monocle3)

# The tutorial shown below and on subsequent pages uses two additional packages:
library(ggplot2)
library(dplyr)
```

## Loading your data
Monocle 3 以细胞基因表达矩阵作为输入。Monocle 3 设计用于绝对转录计数 (例如来自 UMI 实验)。Monocle 3 使用 Cell Ranger 生成的转录计数矩阵 “out-of-the-box”，该软件管道用于分析 10X Genomics Chromium 仪器的实验。Monocle 3 还可以很好地处理来自其他 RNA-Seq 工作流程（例如 sci-RNA-Seq）和 Biorad ddSEQ 等仪器的数据。

## The cell_data_set class
Monocle 在 `cell_data_set` 类的对象中保存单细胞表达数据。该类派生自 Bioconductor `SingleCellExperiment` 类，该类为使用 Bioconductor 分析其他单细胞实验的人提供熟悉的通用接口。该类需要三个输入文件：  
`expression_matrix`,表达量的数值矩阵，其中行是基因，列是细胞  
`cell_metadata`,一个数据框，其中行是细胞，列是细胞的属性(如细胞类型、培养条件、捕获天数等。)  
`gene_metadata`,一个数据框，其中行是特征(例如基因)，列是基因属性，如生物型、gc含量等。

## Generate a cell_data_set
您可以创建一个新的 `cell_data_set` (CDS) 对象，如下所示：
```{r}
# Load the data
expression_matrix <- readRDS(url("https://depts.washington.edu:/trapnell-lab/software/monocle3/celegans/data/cao_l2_expression.rds"))
cell_metadata <- readRDS(url("https://depts.washington.edu:/trapnell-lab/software/monocle3/celegans/data/cao_l2_colData.rds"))
gene_annotation <- readRDS(url("https://depts.washington.edu:/trapnell-lab/software/monocle3/celegans/data/cao_l2_rowData.rds"))


# Make the CDS object
cds <- new_cell_data_set(expression_matrix,
                         cell_metadata = cell_metadata,
                         gene_metadata = gene_annotation)
```

